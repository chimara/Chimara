<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Your Program's Main Function</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="Chimara Reference Manual">
<link rel="up" href="chimara-glk-spec-overall-structure.html" title="Overall Structure">
<link rel="prev" href="chimara-glk-spec-overall-structure.html" title="Overall Structure">
<link rel="next" href="chimara-Exiting-Your-Program.html" title="Exiting Your Program">
<meta name="generator" content="GTK-Doc V1.25 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="chimara-glk-spec-overall-structure.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="chimara-glk-spec-overall-structure.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="chimara-Exiting-Your-Program.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry" lang="en">
<a name="chimara-Your-Programs-Main-Function"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle">Your Program's Main Function</span></h2>
<p>Your Program's Main Function — How Glk starts your program</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1" lang="en">
<a name="idp140340079875472"></a><h2>Description</h2>
<p>
The top level of the program — the <code class="function"><code class="function">main()</code></code> function in C, for example — belongs to Glk.
</p>
<div class="note">
<h3 class="title"></h3>
<p>
This means that Glk isn't really a library. In a sense, you are writing a library, which is linked into Glk. This is bizarre to think about, so forget it.
</p>
</div>
<div class="blockquote"><blockquote class="blockquote"><div class="refsect2" lang="en">
<a name="idp140340080039376"></a><h3>Chimara</h3>
<p>
In Chimara, the arrangement is even more bizarre. Chimara <span class="emphasis"><em>is</em></span> a library, and it runs your Glk program from within a GTK+ graphical application (the “host program”).
Chimara treats your program as a plugin, or shared library, and it executes your program in its own thread, displaying windows and output in the GTK+ program.
</p>
<p>
This makes absolutely no difference to you, the Glk <span class="emphasis"><em>programmer</em></span>; if your program works correctly with a “regular” Glk library, it will also work properly with Chimara.
The only difference is in compiling your Glk program.
</p>
</div></blockquote></div>
<p>
You define a function called <code class="function">glk_main()</code>, which the library calls to begin running your program. <code class="function">glk_main()</code> should run until your program is finished, and then return.
</p>
<p>
Glk does all its user-interface work in a function called <a href="chimara-Events.html#glk-select" title="glk_select ()"><code class="function">glk_select()</code></a>. This function waits for an event — typically the player's input — and returns an structure representing that event. This means that your program must have an event loop. In the very simplest case, you could write
</p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="type">void</span> glk_main()
{
    event_t ev;
    <span class="keyword">while</span> (<span class="number">1</span>) {
        glk_select(&amp;ev);
        <span class="keyword">switch</span> (ev.type) {
            <span class="keyword">default</span>:
                <span class="comment">/*</span><span class="comment"> do nothing </span><span class="comment">*/</span>
                <span class="keyword">break</span>;
        }
    }
}</pre></td>
      </tr>
    </tbody>
  </table>
</div>

<p>
This is a legal Glk-compatible program. As you might expect, it doesn't do anything. The player will see an empty window, which he can only stare at, or destroy in a platform-defined standard manner.
</p>
<div class="note">
<h3 class="title"></h3>
<p>
<span><strong class="keycap">Command</strong></span>+<span><strong class="keycap">period</strong></span> on the Macintosh; a <span class="guimenuitem">kill-window</span> menu option in an X window manager; <span><strong class="keycap">control</strong></span>+<span><strong class="keycap">C</strong></span> in a curses terminal window.
</p>
</div>
<div class="blockquote"><blockquote class="blockquote"><div class="refsect2" lang="en">
<a name="idp140340078097408"></a><h3>Chimara</h3>
<p>
In Chimara, there is no standard way; the program will stop when the host program calls <a href="ChimaraGlk.html#chimara-glk-stop" title="chimara_glk_stop ()"><code class="function">chimara_glk_stop()</code></a>.
The host program might have a “Stop” button which does this, for example, but it will also generally happen when the <a href="ChimaraGlk.html" title="ChimaraGlk"><span class="type">ChimaraGlk</span></a> widget is destroyed or when the host program ends.
</p>
</div></blockquote></div>
<div class="note">
<h3 class="title"></h3>
<p>
However, this program does not spin wildly and burn CPU time. The <a href="chimara-Events.html#glk-select" title="glk_select ()"><code class="function">glk_select()</code></a> function waits for an event it can return. Since it only returns events which you have requested, it will wait forever, and grant CPU time to other processes if that's meaningful on the player's machine.
</p>
</div>
<div class="note">
<h3 class="title"></h3>
<p>
Actually, there are some events which are always reported. More may be defined in future versions of the Glk API. This is why the default response to an event is to do nothing. If you don't recognize the event, ignore it.
</p>
</div>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.25</div>
</body>
</html>