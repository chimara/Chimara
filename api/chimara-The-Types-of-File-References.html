<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>The Types of File References</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="Chimara Reference Manual">
<link rel="up" href="chimara-glk-spec-file-references.html" title="File References">
<link rel="prev" href="chimara-File-References.html" title="File References">
<link rel="next" href="chimara-Other-File-Reference-Functions.html" title="Other File Reference Functions">
<meta name="generator" content="GTK-Doc V1.25 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts">
<a href="#" class="shortcut">Top</a><span id="nav_description">  <span class="dim">|</span> 
                  <a href="#chimara-The-Types-of-File-References.description" class="shortcut">Description</a></span>
</td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="chimara-glk-spec-file-references.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="chimara-File-References.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="chimara-Other-File-Reference-Functions.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry" lang="en">
<a name="chimara-The-Types-of-File-References"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="chimara-The-Types-of-File-References.top_of_page"></a>The Types of File References</span></h2>
<p>The Types of File References — Four different ways to create a file reference</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1" lang="en">
<a name="chimara-The-Types-of-File-References.functions"></a><h2>Functions</h2>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="function_type">
<a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
</td>
<td class="function_name">
<a href="chimara-The-Types-of-File-References.html#glk-fileref-create-temp" title="glk_fileref_create_temp ()">glk_fileref_create_temp</a> <span class="c_punctuation">()</span>
</td>
</tr>
<tr>
<td class="function_type">
<a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
</td>
<td class="function_name">
<a href="chimara-The-Types-of-File-References.html#glk-fileref-create-by-prompt" title="glk_fileref_create_by_prompt ()">glk_fileref_create_by_prompt</a> <span class="c_punctuation">()</span>
</td>
</tr>
<tr>
<td class="function_type">
<a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
</td>
<td class="function_name">
<a href="chimara-The-Types-of-File-References.html#glk-fileref-create-by-name" title="glk_fileref_create_by_name ()">glk_fileref_create_by_name</a> <span class="c_punctuation">()</span>
</td>
</tr>
<tr>
<td class="function_type">
<a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
</td>
<td class="function_name">
<a href="chimara-The-Types-of-File-References.html#glk-fileref-create-from-fileref" title="glk_fileref_create_from_fileref ()">glk_fileref_create_from_fileref</a> <span class="c_punctuation">()</span>
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-The-Types-of-File-References.includes"></a><h2>Includes</h2>
<pre class="synopsis">#include &lt;libchimara/glk.h&gt;
</pre>
</div>
<div class="refsect1" lang="en">
<a name="chimara-The-Types-of-File-References.description"></a><h2>Description</h2>
<p>There are four different functions for creating a fileref, depending on how
you wish to specify it. Remember that it is always possible that a fileref
creation will fail and return <code class="literal">NULL</code>.</p>
</div>
<div class="refsect1" lang="en">
<a name="chimara-The-Types-of-File-References.functions_details"></a><h2>Functions</h2>
<div class="refsect2" lang="en">
<a name="glk-fileref-create-temp"></a><h3>glk_fileref_create_temp ()</h3>
<pre class="programlisting"><a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
glk_fileref_create_temp (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> usage</code></em>,
                         <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> rock</code></em>);</pre>
<p>Creates a reference to a temporary file. It is always a new file (one which
does not yet exist). The file (once created) will be somewhere out of the
player's way.</p>
<div class="note">
<h3 class="title"></h3>
<p>
  This is why no name is specified; the player will never need to know it.
</p>
</div>
<p>A temporary file should never be used for long-term storage. It may be
deleted automatically when the program exits, or at some later time, say
when the machine is turned off or rebooted. You do not have to worry about
deleting it yourself.</p>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-temp.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>usage</p></td>
<td class="parameter_description"><p>Bitfield with one or more of the <code class="literal">fileusage_</code> constants.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>rock</p></td>
<td class="parameter_description"><p>The new fileref's rock value.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-temp.returns"></a><h4>Returns</h4>
<p> A new fileref, or <span class="type">NULL</span> if the fileref creation failed.</p>
</div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="glk-fileref-create-by-prompt"></a><h3>glk_fileref_create_by_prompt ()</h3>
<pre class="programlisting"><a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
glk_fileref_create_by_prompt (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> usage</code></em>,
                              <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> fmode</code></em>,
                              <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> rock</code></em>);</pre>
<p>Creates a reference to a file by asking the player to locate it. The library
may simply prompt the player to type a name, or may use a platform-native
file navigation tool. (The prompt, if any, is inferred from the usage
argument.)</p>
<div class="blockquote"><blockquote class="blockquote"><div class="refsect2" lang="en">
<a name="idp140340078382752"></a><h3>Chimara</h3>
<p>Chimara uses a <span class="type">GtkFileChooserDialog</span>.
The default starting location for the dialog may be set with
<a href="chimara-Unix-Extensions.html#glkunix-set-base-file" title="glkunix_set_base_file ()"><code class="function">glkunix_set_base_file()</code></a>.</p>
</div></blockquote></div>
<p><em class="parameter"><code>fmode</code></em>
 must be one of these values:</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><a href="chimara-Streams.html#filemode-Read" title="filemode_Read"><code class="literal">filemode_Read</code></a></span></td>
<td><p>The file must already exist; and the player will be asked
  to select from existing files which match the usage.</p></td>
</tr>
<tr>
<td><span class="term"><a href="chimara-Streams.html#filemode-Write" title="filemode_Write"><code class="literal">filemode_Write</code></a></span></td>
<td><p>The file should not exist; if the player selects an
  existing file, he will be warned that it will be replaced.
  </p></td>
</tr>
<tr>
<td><span class="term"><a href="chimara-Streams.html#filemode-ReadWrite" title="filemode_ReadWrite"><code class="literal">filemode_ReadWrite</code></a></span></td>
<td><p>The file may or may not exist; if it already exists, the
  player will be warned that it will be modified.</p></td>
</tr>
<tr>
<td><span class="term"><a href="chimara-Streams.html#filemode-WriteAppend" title="filemode_WriteAppend"><code class="literal">filemode_WriteAppend</code></a></span></td>
<td><p>Same behavior as <a href="chimara-Streams.html#filemode-ReadWrite" title="filemode_ReadWrite"><code class="literal">filemode_ReadWrite</code></a>.</p></td>
</tr>
</tbody>
</table></div>
<p>The <em class="parameter"><code>fmode</code></em>
 argument should generally match the <em class="parameter"><code>fmode</code></em>
 which will be used to
open the file.</p>
<div class="note">
<h3 class="title"></h3>
<p>
  It is likely that the prompt or file tool will have a “cancel” option.
  If the player chooses this, <a href="chimara-The-Types-of-File-References.html#glk-fileref-create-by-prompt" title="glk_fileref_create_by_prompt ()"><code class="function">glk_fileref_create_by_prompt()</code></a> will return
  <code class="literal">NULL</code>.
  This is a major reason why you should make sure the return value is valid
  before you use it.
</p>
</div>
<p>The recommended file suffixes for files are <code class="literal">.glkdata</code> for <a href="chimara-File-References.html#fileusage-Data" title="fileusage_Data"><code class="literal">fileusage_Data</code></a>,
<code class="literal">.glksave</code> for <a href="chimara-File-References.html#fileusage-SavedGame" title="fileusage_SavedGame"><code class="literal">fileusage_SavedGame</code></a>, <code class="literal">.txt</code> for <a href="chimara-File-References.html#fileusage-Transcript" title="fileusage_Transcript"><code class="literal">fileusage_Transcript</code></a> and
<a href="chimara-File-References.html#fileusage-InputRecord" title="fileusage_InputRecord"><code class="literal">fileusage_InputRecord</code></a>.</p>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-by-prompt.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>usage</p></td>
<td class="parameter_description"><p>Bitfield with one or more of the <code class="literal">fileusage_</code> constants.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>fmode</p></td>
<td class="parameter_description"><p>File mode, contolling the dialog's behavior.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>rock</p></td>
<td class="parameter_description"><p>The new fileref's rock value.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-by-prompt.returns"></a><h4>Returns</h4>
<p> A new fileref, or <span class="type">NULL</span> if the fileref creation failed or the
dialog was canceled.</p>
</div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="glk-fileref-create-by-name"></a><h3>glk_fileref_create_by_name ()</h3>
<pre class="programlisting"><a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
glk_fileref_create_by_name (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> usage</code></em>,
                            <em class="parameter"><code><span class="type">char</span> *name</code></em>,
                            <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> rock</code></em>);</pre>
<p>This creates a reference to a file with a specific name. The file will be
in a fixed location relevant to your program, and visible to the player.</p>
<div class="note">
<h3 class="title"></h3>
<p>
  This usually means “in the same directory as your program.”
</p>
</div>
<div class="blockquote"><blockquote class="blockquote"><div class="refsect2" lang="en">
<a name="idp140340080255136"></a><h3>Chimara</h3>
<p>In Chimara, the file is created in the directory last set by
<a href="chimara-Unix-Extensions.html#glkunix-set-base-file" title="glkunix_set_base_file ()"><code class="function">glkunix_set_base_file()</code></a>, and otherwise in the current working directory.</p>
</div></blockquote></div>
<p>Earlier versions of the Glk spec specified that the library may have to
extend, truncate, or change your name argument in order to produce a legal
native filename. This remains true. However, since Glk was originally
proposed, the world has largely reached consensus about what a filename looks
like. Therefore, it is worth including some recommended library behavior
here. Libraries that share this behavior will more easily be able to exchange
files, which may be valuable both to authors (distributing data files for
games) and for players (moving data between different computers or different
applications).</p>
<p>The library should take the given filename argument, and delete any
characters illegal for a filename. This will include all of the following
characters (and more, if the OS requires it): slash, backslash, angle
brackets (less-than and greater-than), colon, double-quote, pipe (vertical
bar), question-mark, asterisk. The library should also truncate the argument
at the first period (delete the first period and any following characters).
If the result is the empty string, change it to the string <code class="literal">"null"</code>.</p>
<p>It should then append an appropriate suffix, depending on the usage:
<code class="literal">.glkdata</code> for <a href="chimara-File-References.html#fileusage-Data" title="fileusage_Data"><code class="literal">fileusage_Data</code></a>, <code class="literal">.glksave</code> for <a href="chimara-File-References.html#fileusage-SavedGame" title="fileusage_SavedGame"><code class="literal">fileusage_SavedGame</code></a>, <code class="literal">.txt</code>
for <a href="chimara-File-References.html#fileusage-Transcript" title="fileusage_Transcript"><code class="literal">fileusage_Transcript</code></a> and <a href="chimara-File-References.html#fileusage-InputRecord" title="fileusage_InputRecord"><code class="literal">fileusage_InputRecord</code></a>.</p>
<p>The above behavior is not a requirement of the Glk spec. Older
implementations can continue doing what they do. Some programs (e.g.
web-based interpreters) may not have access to a traditional filesystem at
all, and to them these recommendations will be meaningless.</p>
<p>On the other side of the coin, the game file should not press these
limitations. Best practice is for the game to pass a filename containing only
letters and digits, beginning with a letter, and not mixing upper and lower
case. Avoid overly-long filenames.</p>
<div class="note">
<h3 class="title"></h3>
<p>
  The earlier Glk spec gave more stringent recommendations: “No more than 8
  characters, consisting entirely of upper-case letters and numbers, starting
  with a letter”.
  The DOS era is safely contained, if not over, so this has been relaxed.
  The I7 manual recommends “23 characters or fewer”.
</p>
</div>
<div class="note">
<h3 class="title"></h3>
<p>
  To address other complications:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>
      Some filesystems are case-insensitive. If you create two filerefs with
      the names <code class="filename">File</code> and <code class="filename">FILE</code>, they
      may wind up pointing to the same file, or they may not. Avoid doing
      this.
    </p></li>
<li><p>
      Some programs will look for all files in the same directory as the
      program itself (or, for interpreted games, in the same directory as the
      game file). Others may keep files in a data-specific directory
      appropriate for the user (e.g., <code class="filename">~/Library</code> on MacOS).
    </p></li>
<li><p>
      If a game interpreter uses a data-specific directory, there is a
      question of whether to use a common location, or divide it into
      game-specific subdirectories. (Or to put it another way: should the
      namespace of named files be per-game or app-wide?) Since data files may
      be exchanged between games, they should be given an app-wide namespace.
      In contrast, saved games should be per-game, as they can never be
      exchanged. Transcripts and input records can go either way.
    </p></li>
<li><p>
      When updating an older library to follow these recommendations,
      consider backwards compatibility for games already installed. When
      opening an existing file (that is, not in a write-only mode) it may be
      worth looking under the older name (suffix) if the newer one does not
      already exist.
    </p></li>
<li><p>
      Game-save files are already stored with a variety of file suffixes,
      since that usage goes back to the oldest IF interpreters, long
      predating Glk. It is reasonable to treat them in some special way,
      while hewing closer to these recommendations for data files.
    </p></li>
</ul></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-by-name.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>usage</p></td>
<td class="parameter_description"><p>Bitfield with one or more of the <code class="literal">fileusage_</code> constants.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>name</p></td>
<td class="parameter_description"><p>A filename.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>rock</p></td>
<td class="parameter_description"><p>The new fileref's rock value.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-by-name.returns"></a><h4>Returns</h4>
<p> A new fileref, or <code class="literal">NULL</code> if the fileref creation failed. </p>
</div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="glk-fileref-create-from-fileref"></a><h3>glk_fileref_create_from_fileref ()</h3>
<pre class="programlisting"><a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="returnvalue">frefid_t</span></a>
glk_fileref_create_from_fileref (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> usage</code></em>,
                                 <em class="parameter"><code><a href="chimara-Opaque-Objects.html#frefid-t" title="frefid_t"><span class="type">frefid_t</span></a> fref</code></em>,
                                 <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> rock</code></em>);</pre>
<p>This copies an existing file reference <em class="parameter"><code>fref</code></em>
, but changes the usage. (The
original fileref is not modified.)</p>
<p>The use of this function can be tricky. If you change the type of the fileref
(<a href="chimara-File-References.html#fileusage-Data" title="fileusage_Data"><code class="literal">fileusage_Data</code></a>, <a href="chimara-File-References.html#fileusage-SavedGame" title="fileusage_SavedGame"><code class="literal">fileusage_SavedGame</code></a>, etc), the new reference may or may
not point to the same actual disk file.</p>
<div class="note">
<h3 class="title"></h3>
<p>
  Most platforms use suffixes to indicate file type, so it typically will
  not. See the earlier comments about recommended file suffixes.
</p>
</div>
<p>If you do this, and open both file references for writing, the results are
unpredictable. It is safest to change the type of a fileref only if it refers
to a nonexistent file.</p>
<p>If you change the mode of a fileref (<a href="chimara-File-References.html#fileusage-TextMode" title="fileusage_TextMode"><code class="literal">fileusage_TextMode</code></a>,
<a href="chimara-File-References.html#fileusage-BinaryMode" title="fileusage_BinaryMode"><code class="literal">fileusage_BinaryMode</code></a>), but leave the rest of the type unchanged, the new
fileref will definitely point to the same disk file as the old one.</p>
<p>Obviously, if you write to a file in text mode and then read from it in
binary mode, the results are platform-dependent.</p>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-from-fileref.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>usage</p></td>
<td class="parameter_description"><p>Bitfield with one or more of the <code class="literal">fileusage_</code> constants.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>fref</p></td>
<td class="parameter_description"><p>Fileref to copy.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>rock</p></td>
<td class="parameter_description"><p>The new fileref's rock value.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-fileref-create-from-fileref.returns"></a><h4>Returns</h4>
<p> A new fileref, or <code class="literal">NULL</code> if the fileref creation failed. </p>
</div>
</div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-The-Types-of-File-References.other_details"></a><h2>Types and Values</h2>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.25</div>
</body>
</html>