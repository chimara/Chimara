<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Getting Argument Prototypes</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="Chimara Reference Manual">
<link rel="up" href="chimara-glk-spec-the-dispatch-layer.html" title="Appendix A. The Dispatch Layer">
<link rel="prev" href="chimara-Dispatching.html" title="Dispatching">
<link rel="next" href="chimara-Functions-the-Library-Must-Provide.html" title="Functions the Library Must Provide">
<meta name="generator" content="GTK-Doc V1.25 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts">
<a href="#" class="shortcut">Top</a><span id="nav_description">  <span class="dim">|</span> 
                  <a href="#chimara-Getting-Argument-Prototypes.description" class="shortcut">Description</a></span>
</td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="chimara-glk-spec-the-dispatch-layer.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="chimara-Dispatching.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="chimara-Functions-the-Library-Must-Provide.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry" lang="en">
<a name="chimara-Getting-Argument-Prototypes"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="chimara-Getting-Argument-Prototypes.top_of_page"></a>Getting Argument Prototypes</span></h2>
<p>Getting Argument Prototypes — Querying Glk function prototypes</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1" lang="en">
<a name="chimara-Getting-Argument-Prototypes.functions"></a><h2>Functions</h2>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
</colgroup>
<tbody><tr>
<td class="function_type">
<span class="returnvalue">char</span> *
</td>
<td class="function_name">
<a href="chimara-Getting-Argument-Prototypes.html#gidispatch-prototype" title="gidispatch_prototype ()">gidispatch_prototype</a> <span class="c_punctuation">()</span>
</td>
</tr></tbody>
</table></div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Getting-Argument-Prototypes.includes"></a><h2>Includes</h2>
<pre class="synopsis">#include &lt;libchimara/glk.h&gt;
#include &lt;libchimara/gi-dispa.h&gt;
</pre>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Getting-Argument-Prototypes.description"></a><h2>Description</h2>
<p>There are many possible ways to set up a <a href="chimara-Dispatching.html#gluniversal-t" title="gluniversal_t"><span class="type">gluniversal_t</span></a> array, and it's
illegal to call <a href="chimara-Dispatching.html#gidispatch-call" title="gidispatch_call ()"><code class="function">gidispatch_call()</code></a> with an array which doesn't match the
function. Furthermore, some references are passed in, some passed out, and
some both. How do you know how to handle the argument list?</p>
<p>One possibility is to recognize each function selector, and set up the
arguments appropriately. However, this entails writing special code for each
Glk function; which is exactly what we don't want to do.</p>
<p>Instead, you can call <a href="chimara-Getting-Argument-Prototypes.html#gidispatch-prototype" title="gidispatch_prototype ()"><code class="function">gidispatch_prototype()</code></a>.</p>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Getting-Argument-Prototypes.functions_details"></a><h2>Functions</h2>
<div class="refsect2" lang="en">
<a name="gidispatch-prototype"></a><h3>gidispatch_prototype ()</h3>
<pre class="programlisting"><span class="returnvalue">char</span> *
gidispatch_prototype (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> funcnum</code></em>);</pre>
<p>This returns a string which encodes the proper argument list for the given
function. If there is no such function in the library, this returns <code class="literal">NULL</code>.</p>
<p>The prototype string for the <code class="literal">glk_glomp()</code> function described above would be:
<code class="literal">"4IuQa&amp;Iu&amp;Qb:"</code>.
The <code class="literal">"4"</code> is the number of arguments (including the return value, if there is
one, which in this case there isn't.)
<code class="literal">"Iu"</code> denotes an unsigned integer; <code class="literal">"Qa"</code> is an opaque object of class 0
(window).
<code class="literal">"&amp;Iu"</code> is a <span class="emphasis"><em>reference</em></span> to an unsigned integer, and
<code class="literal">"&amp;Qb"</code> is a reference to a stream.
The colon at the end terminates the argument list; the return value would
follow it, if there was one.</p>
<p>Note that the initial number (<code class="literal">"4"</code> in this case) is the number of logical
arguments, not the number of <a href="chimara-Dispatching.html#gluniversal-t" title="gluniversal_t"><span class="type">gluniversal_t</span></a> objects which will be passed to
<a href="chimara-Dispatching.html#gidispatch-call" title="gidispatch_call ()"><code class="function">gidispatch_call()</code></a>.
The <code class="literal">glk_glomp()</code> call uses anywhere from four to six <a href="chimara-Dispatching.html#gluniversal-t" title="gluniversal_t"><span class="type">gluniversal_t</span></a> objects,
as demonstrated above.</p>
<p>The basic type codes:</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><code class="code">Iu, Is</code></span></td>
<td><p>Unsigned and signed 32-bit integer.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">Cn, Cu, Cs</code></span></td>
<td>
<p>Character, <span class="type">unsigned</span> <span class="type">char</span>, and <span class="type">signed</span> <span class="type">char</span>.</p>
<div class="note">
<h3 class="title"></h3>
<p>Of course <code class="code">Cn</code> will be the same as either 
    <code class="code">Cu</code> or <code class="code">Cs</code>, depending on the platform. For this
    reason, Glk avoids using it, but it is included here for completeness.
    </p>
</div>
</td>
</tr>
<tr>
<td><span class="term"><code class="code">S</code></span></td>
<td><p>A C-style string (null-terminated array of <span class="type">char</span>). In Glk,
  strings are always treated as read-only and used immediately; the library
  does not retain a reference to a string between Glk calls. A Glk call that
  wants to use writable char arrays will use an array type 
  (<code class="code">"#C"</code>), not string (<code class="code">"S"</code>).</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">U</code></span></td>
<td><p>A zero-terminated array of 32-bit integers. This is
  primarily intended as a Unicode equivalent of <code class="code">"S"</code>. Like 
  <code class="code">"S"</code> strings, <code class="code">"U"</code> strings are read-only and used
  immediately. A Glk call that wants to use writable Unicode arrays will use
  an array type (<code class="code">"#Iu"</code>) instead of <code class="code">"U"</code>.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">F</code></span></td>
<td><p>A floating-point value. Glk does not currently use
  floating-point values, but we might as well define a code for them.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">Qa, Qb, Qc...</code></span></td>
<td>
<p>A reference to an opaque object. The second letter
  determines which class is involved. (The number of classes can be gleaned
  from <a href="chimara-Interrogating-the-Interface.html#gidispatch-count-classes" title="gidispatch_count_classes ()"><code class="function">gidispatch_count_classes()</code></a>; see <a href="chimara-Interrogating-the-Interface.html" title="Interrogating the Interface">Interrogating the
  Interface</a>).</p>
<div class="note">
<h3 class="title"></h3>
<p>
    If Glk expands to have more than 26 classes, we'll think of something.
  </p>
</div>
</td>
</tr>
</tbody>
</table></div>
<p>Any type code can be prefixed with one or more of the following characters:</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><code class="code">&amp;</code></span></td>
<td><p>A reference to the type; or, if you like, a variable passed
  by reference. The reference is passed both in and out, so you must copy the
  value in before calling <a href="chimara-Dispatching.html#gidispatch-call" title="gidispatch_call ()"><code class="function">gidispatch_call()</code></a> and copy it out afterward.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">&lt;</code></span></td>
<td><p>A reference which is pass-out only. The initial value is
  ignored, so you only need copy out the value after the call.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">&gt;</code></span></td>
<td>
<p>A reference which is pass-in only.</p>
<div class="note">
<h3 class="title"></h3>
<p>
    This is not generally used for simple types, but is useful for structures
    and arrays.
  </p>
</div>
</td>
</tr>
<tr>
<td><span class="term"><code class="code">+</code></span></td>
<td>
<p>Combined with <code class="code">"&amp;"</code>, <code class="code">"&lt;"</code>, or 
  <code class="code">"&gt;"</code>, indicates that a valid reference is mandatory; <code class="literal">NULL</code>
  cannot be passed.</p>
<div class="note">
<h3 class="title"></h3>
<p>
    Note that even though the <em class="parameter"><code>ptrflag</code></em> <a href="chimara-Dispatching.html#gluniversal-t" title="gluniversal_t"><span class="type">gluniversal_t</span></a> for a <code class="code">"+"</code>
    reference is always <code class="literal">TRUE</code>, it cannot be omitted.
  </p>
</div>
</td>
</tr>
<tr>
<td><span class="term"><code class="code">:</code></span></td>
<td><p>The colon separates the arguments from the return value, or
  terminates the string if there is no return value. Since return values are
  always non-<code class="literal">NULL</code> pass-out references, you may treat <code class="code">":"</code> as
  equivalent to <code class="code">"&lt;+"</code>. The colon is never combined with any
  other prefix character.</p></td>
</tr>
<tr>
<td><span class="term"><code class="code">[...]</code></span></td>
<td>
<p>Combined with <code class="code">"&amp;"</code>, <code class="code">"&lt;"</code>, or 
  <code class="code">"&gt;"</code>, indicates a structure reference. Between the brackets
  is a complete argument list encoding string, including the number of
  arguments.</p>
<div class="note">
<h3 class="title"></h3>
<p>
    For example, the prototype string for <a href="chimara-Events.html#glk-select" title="glk_select ()"><code class="function">glk_select()</code></a> is
    <code class="code">"1&lt;+[4IuQaIuIu]:"</code> — one argument, which is a
    pass-out non-<code class="literal">NULL</code> reference to a structure, which contains four
    arguments.
  </p>
</div>
<p>Currently, structures in Glk contain only basic types.</p>
</td>
</tr>
<tr>
<td><span class="term"><code class="code">#</code></span></td>
<td>
<p>Combined with <code class="code">"&amp;"</code>, <code class="code">"&lt;"</code>, or 
  <code class="code">"&gt;"</code>, indicates an array reference. As described above, this
  encompasses up to three <a href="chimara-Dispatching.html#gluniversal-t" title="gluniversal_t"><span class="type">gluniversal_t</span></a> objects — <em class="parameter"><code>ptrflag</code></em>, pointer,
  and integer length.</p>
<div class="note">
<h3 class="title"></h3>
<p>
    Depending on the design of your program, you may wish to pass a pointer
    directly to your program's memory, or allocate an array and copy the
    contents in and out.
    See [Arrays][chimara-Arrays].
  </p>
</div>
</td>
</tr>
<tr>
<td><span class="term"><code class="code">!</code></span></td>
<td>
<p>Combined with <code class="code">"#"</code>, indicates that the
  array is retained by the library. The library will keep a reference to the
  array; the contents are undefined until further notice. You should not use
  or copy the contents of the array out after the call, even for 
  <code class="code">"&amp;#!"</code> or <code class="code">"&lt;#!"</code> arrays. Instead, do
  it when the library releases the array.</p>
<div class="note">
<h3 class="title"></h3>
<p>
    For example, <a href="chimara-The-Types-of-Streams.html#glk-stream-open-memory" title="glk_stream_open_memory ()"><code class="function">glk_stream_open_memory()</code></a> retains the array that you pass it,
    and releases it when the stream is closed. The library can notify you
    automatically when arrays are retained and released; see [Retained Array
    Registry][gidispatch-set-retained-registry].
  </p>
</div>
</td>
</tr>
</tbody>
</table></div>
<p>The order of these characters and prefixes is not completely arbitrary. Here
is a formal grammar for the prototype strings.</p>
<div class="note">
<h3 class="title"></h3>
<p>Thanks to Neil Cerutti for working this out.</p>
</div>
<table width="100%" cellpadding="5" bgcolor="#F5DCB3" border="1" class="productionset" summary="EBNF"><tr><td><table border="0" width="99%" cellpadding="0" bgcolor="#F5DCB3" class="productionset" summary="EBNF productions">
<tr>
<td align="left" valign="top" width="3%">[1]</td>
<td align="right" valign="top" width="10%">
<a name="prototype"></a>prototype</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">ArgCount [ <a href="chimara-Getting-Argument-Prototypes.html#arg_list">arg_list</a> ]
    ':' [ <a href="chimara-Getting-Argument-Prototypes.html#arg">arg</a> ] EOL</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[2]</td>
<td align="right" valign="top" width="10%">
<a name="arg_list"></a>arg_list</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">
<a href="chimara-Getting-Argument-Prototypes.html#arg">arg</a> { <a href="chimara-Getting-Argument-Prototypes.html#arg">arg</a> }</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[3]</td>
<td align="right" valign="top" width="10%">
<a name="arg"></a>arg</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">TypeName | <a href="chimara-Getting-Argument-Prototypes.html#ref_type">ref_type</a>
  </td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[4]</td>
<td align="right" valign="top" width="10%">
<a name="ref_type"></a>ref_type</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">RefType [ '+' ] <a href="chimara-Getting-Argument-Prototypes.html#target_type">target_type</a>
</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[5]</td>
<td align="right" valign="top" width="10%">
<a name="target_type"></a>target_type</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">TypeName | <a href="chimara-Getting-Argument-Prototypes.html#array">array</a> |
    <a href="chimara-Getting-Argument-Prototypes.html#struct">struct</a>
</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[6]</td>
<td align="right" valign="top" width="10%">
<a name="array"></a>array</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">'#' [ '!' ] TypeName</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
<tr>
<td align="left" valign="top" width="3%">[7]</td>
<td align="right" valign="top" width="10%">
<a name="struct"></a>struct</td>
<td valign="top" width="5%" align="center"><code>::=</code></td>
<td valign="top" width="52%">'[' ArgCount [ <a href="chimara-Getting-Argument-Prototypes.html#arg_list">arg_list</a>
    ] ']'</td>
<td align="left" valign="top" width="30%"> </td>
</tr>
</table></td></tr></table>
<div class="constraintdef">
<a name="TypeName"></a>
  <p>TypeName is <code class="code">I[us]|C[nus]|S|U|F|Q[a-z]</code>
  </p>
</div>
<div class="constraintdef">
<a name="ArgCount"></a>
  <p>ArgCount is <code class="code">\d+</code></p>
</div>
<div class="constraintdef">
<a name="RefType"></a>
  <p>RefType is <code class="code">&amp;|&lt;|&gt;</code></p>
</div>
<div class="constraintdef">
<a name="EOL"></a>
  <p>EOL is end of input</p>
</div>
<div class="refsect3" lang="en">
<a name="gidispatch-prototype.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody><tr>
<td class="parameter_name"><p>funcnum</p></td>
<td class="parameter_description"><p>A selector for the function to be queried.</p></td>
<td class="parameter_annotations"> </td>
</tr></tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="gidispatch-prototype.returns"></a><h4>Returns</h4>
<p> A string which encodes the prototype of the specified Glk function.</p>
</div>
</div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Getting-Argument-Prototypes.other_details"></a><h2>Types and Values</h2>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.25</div>
</body>
</html>