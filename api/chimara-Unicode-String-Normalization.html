<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Unicode String Normalization</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="Chimara Reference Manual">
<link rel="up" href="chimara-glk-spec-character-encoding.html" title="Character Encoding">
<link rel="prev" href="chimara-Upper-and-Lower-Case.html" title="Upper and Lower Case">
<link rel="next" href="chimara-A-Note-on-Unicode-Case-Folding-and-Normalization.html" title="A Note on Unicode Case-Folding and Normalization">
<meta name="generator" content="GTK-Doc V1.25 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts">
<a href="#" class="shortcut">Top</a><span id="nav_description">  <span class="dim">|</span> 
                  <a href="#chimara-Unicode-String-Normalization.description" class="shortcut">Description</a></span>
</td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="chimara-glk-spec-character-encoding.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="chimara-Upper-and-Lower-Case.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="chimara-A-Note-on-Unicode-Case-Folding-and-Normalization.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry" lang="en">
<a name="chimara-Unicode-String-Normalization"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="chimara-Unicode-String-Normalization.top_of_page"></a>Unicode String Normalization</span></h2>
<p>Unicode String Normalization — Combining characters</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1" lang="en">
<a name="chimara-Unicode-String-Normalization.functions"></a><h2>Functions</h2>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="function_type">
<a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="returnvalue">glui32</span></a>
</td>
<td class="function_name">
<a href="chimara-Unicode-String-Normalization.html#glk-buffer-canon-decompose-uni" title="glk_buffer_canon_decompose_uni ()">glk_buffer_canon_decompose_uni</a> <span class="c_punctuation">()</span>
</td>
</tr>
<tr>
<td class="function_type">
<a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="returnvalue">glui32</span></a>
</td>
<td class="function_name">
<a href="chimara-Unicode-String-Normalization.html#glk-buffer-canon-normalize-uni" title="glk_buffer_canon_normalize_uni ()">glk_buffer_canon_normalize_uni</a> <span class="c_punctuation">()</span>
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Unicode-String-Normalization.includes"></a><h2>Includes</h2>
<pre class="synopsis">#include &lt;libchimara/glk.h&gt;
</pre>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Unicode-String-Normalization.description"></a><h2>Description</h2>
<p>Comparing Unicode strings is difficult, because there can be several ways to
represent a piece of text as a Unicode string. For example, the one-character
string “è” (an accented “e”) will be displayed the same as the
two-character string containing “e” followed by Unicode character 0x0300
(COMBINING GRAVE ACCENT).
These strings should be considered equal.</p>
<p>Therefore, a Glk program that accepts line input should convert its text to a
normalized form before parsing it. These functions offer those conversions.
The algorithms are defined by the Unicode spec (chapter 3.7) and <a href="http://www.unicode.org/reports/tr15/" target="_top">Unicode
Standard Annex #15</a>.</p>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Unicode-String-Normalization.functions_details"></a><h2>Functions</h2>
<div class="refsect2" lang="en">
<a name="glk-buffer-canon-decompose-uni"></a><h3>glk_buffer_canon_decompose_uni ()</h3>
<pre class="programlisting"><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="returnvalue">glui32</span></a>
glk_buffer_canon_decompose_uni (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> *buf</code></em>,
                                <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> len</code></em>,
                                <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> numchars</code></em>);</pre>
<p>This transforms a string into its canonical decomposition (“Normalization
Form D”).
Effectively, this takes apart multipart characters into their individual
parts.
For example, it would convert “è” (character 0xE8, an accented “e”)
into the two-character string containing “e” followed by Unicode character
0x0300 (COMBINING GRAVE ACCENT).
If a single character has multiple accent marks, they are also rearranged
into a standard order.</p>
<div class="refsect3" lang="en">
<a name="glk-buffer-canon-decompose-uni.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>buf</p></td>
<td class="parameter_description"><p>A character array in UCS-4.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>len</p></td>
<td class="parameter_description"><p>Available length of <em class="parameter"><code>buf</code></em>
.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>numchars</p></td>
<td class="parameter_description"><p>Number of characters in <em class="parameter"><code>buf</code></em>
.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-buffer-canon-decompose-uni.returns"></a><h4>Returns</h4>
<p> The number of characters in <em class="parameter"><code>buf</code></em>
after decomposition.</p>
</div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="glk-buffer-canon-normalize-uni"></a><h3>glk_buffer_canon_normalize_uni ()</h3>
<pre class="programlisting"><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="returnvalue">glui32</span></a>
glk_buffer_canon_normalize_uni (<em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> *buf</code></em>,
                                <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> len</code></em>,
                                <em class="parameter"><code><a href="chimara-Basic-Types.html#glui32" title="glui32"><span class="type">glui32</span></a> numchars</code></em>);</pre>
<p>This transforms a string into its canonical decomposition and recomposition
(“Normalization Form C”).
Effectively, this takes apart multipart characters, and then puts them back
together in a standard way.
For example, this would convert the two-character string containing “e”
followed by Unicode character 0x0300 (COMBINING GRAVE ACCENT) into the
one-character string “è” (character 0xE8, an accented “e”).</p>
<p>The <code class="literal">canon_normalize</code> function includes decomposition as part of its
implementation.
You never have to call both functions on the same string.</p>
<p>Both of these functions are idempotent.</p>
<p>These functions provide two length arguments because a string of Unicode
characters may expand when it is transformed. The <em class="parameter"><code>len</code></em>
 argument is the
available length of the buffer; <em class="parameter"><code>numchars</code></em>
 is the number of characters in the
buffer initially. (So <em class="parameter"><code>numchars</code></em>
 must be less than or equal to <em class="parameter"><code>len</code></em>
. The
contents of the buffer after <em class="parameter"><code>numchars</code></em>
 do not affect the operation.)</p>
<p>The functions return the number of characters after transformation. If this
is greater than <em class="parameter"><code>len</code></em>
, the characters in the array will be safely truncated at
<em class="parameter"><code>len</code></em>
, but the true count will be returned. (The contents of the buffer after
the returned count are undefined.)</p>
<div class="note">
<h3 class="title"></h3>
<p>
  The Unicode spec also defines stronger forms of these functions, called
  “compatibility decomposition and recomposition” (“Normalization Form KD”
  and “Normalization Form KC”.)
  These do all of the accent-mangling described above, but they also
  transform many other obscure Unicode characters into more familiar forms.
  For example, they split ligatures apart into separate letters.
  They also convert Unicode display variations such as script letters,
  circled letters, and half-width letters into their common forms.
</p>
</div>
<div class="note">
<h3 class="title"></h3>
<p>
  The Glk spec does not currently provide these stronger transformations.
  Glk's expected use of Unicode normalization is for line input, and an OS
  facility for line input will generally not produce these alternate
  character forms (unless the user goes out of his way to type them).
  Therefore, the need for these transformations does not seem to be worth the
  extra data table space.
</p>
</div>
<div class="refsect3" lang="en">
<a name="glk-buffer-canon-normalize-uni.parameters"></a><h4>Parameters</h4>
<div class="informaltable"><table width="100%" border="0">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="parameter_name"><p>buf</p></td>
<td class="parameter_description"><p>A character array in UCS-4.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>len</p></td>
<td class="parameter_description"><p>Available length of <em class="parameter"><code>buf</code></em>
.</p></td>
<td class="parameter_annotations"> </td>
</tr>
<tr>
<td class="parameter_name"><p>numchars</p></td>
<td class="parameter_description"><p>Number of characters in <em class="parameter"><code>buf</code></em>
.</p></td>
<td class="parameter_annotations"> </td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsect3" lang="en">
<a name="glk-buffer-canon-normalize-uni.returns"></a><h4>Returns</h4>
<p> the number of characters in <em class="parameter"><code>buf</code></em>
after normalization.</p>
</div>
</div>
</div>
<div class="refsect1" lang="en">
<a name="chimara-Unicode-String-Normalization.other_details"></a><h2>Types and Values</h2>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.25</div>
</body>
</html>